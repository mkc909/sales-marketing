name = "progeodata-queue-consumer"
main = "src/index.ts"
compatibility_date = "2024-11-28"
compatibility_flags = ["nodejs_compat"]
account_id = "af57e902fd9dcaad7484a7195ac0f536"

# Queue consumer configuration
[[queues.consumers]]
queue = "progeodata-scrape-queue"
max_batch_size = 10
max_batch_timeout = 30
max_retries = 3
dead_letter_queue = "progeodata-scrape-dlq"

# D1 database binding for storage
[[d1_databases]]
binding = "DB"
database_name = "progeodata-db"
database_id = "4f712234-599b-4908-a4f3-20f11cba6564"

# Service binding to scraper-browser worker
[[services]]
binding = "SCRAPER"
service = "scraper-browser"

# KV for rate limiting state
[[kv_namespaces]]
binding = "RATE_LIMIT_STATE"
id = "43e20935e9154d828051c9dbf35bffbd"

# Environment variables
[vars]
CONSUMER_VERSION = "1.0.0"
MAX_CONCURRENT_SCRAPES = "1"
RATE_LIMIT_DELAY_MS = "1000"

# Development environment
[env.development]
vars = { DEBUG = "true" }
