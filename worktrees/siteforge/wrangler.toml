name = "estateflow"
compatibility_date = "2024-11-28"
compatibility_flags = ["nodejs_compat"]
pages_build_output_dir = "build/client"

# CRITICAL: Pages Functions configuration
# Removed [site] section as it conflicts with Pages Functions

# Database binding at root level for Pages
[[d1_databases]]
binding = "DB"
database_name = "estateflow-db"
database_id = "857b7e12-732f-4f8e-9c07-2f1482a5b76c"

# KV namespaces at root level for Pages
[[kv_namespaces]]
binding = "LINKS"
id = "ec019d5680f947a3a0168d9ae49538a0"

[[kv_namespaces]]
binding = "PINS"
id = "32fa94570ef447adab5164ad83f1472b"

[[kv_namespaces]]
binding = "CACHE"
id = "3b7a129d1c834cad988a406cff5d9e45"

[[kv_namespaces]]
binding = "ANALYTICS_BUFFER"
id = "f3019821e7b64f1aa9650c1edacb6f1f"

# R2 buckets at root level for Pages
[[r2_buckets]]
binding = "ESTATEFLOW_ASSETS"
bucket_name = "estateflow-assets"

[[r2_buckets]]
binding = "PROFILE_PHOTOS"
bucket_name = "profile-photos"

[[r2_buckets]]
binding = "PROPERTY_IMAGES"
bucket_name = "property-images"

[[r2_buckets]]
binding = "DOCUMENTS"
bucket_name = "documents"

[[r2_buckets]]
binding = "QR_CODES"
bucket_name = "qr-codes"

[env.production]
vars = { ENVIRONMENT = "production" }

[[env.production.d1_databases]]
binding = "DB"
database_name = "estateflow-db"
database_id = "857b7e12-732f-4f8e-9c07-2f1482a5b76c"

[[env.production.kv_namespaces]]
binding = "LINKS"
id = "ec019d5680f947a3a0168d9ae49538a0"

[[env.production.kv_namespaces]]
binding = "PINS"
id = "32fa94570ef447adab5164ad83f1472b"

[[env.production.kv_namespaces]]
binding = "CACHE"
id = "3b7a129d1c834cad988a406cff5d9e45"

[[env.production.kv_namespaces]]
binding = "ANALYTICS_BUFFER"
id = "f3019821e7b64f1aa9650c1edacb6f1f"

[[env.production.r2_buckets]]
binding = "ESTATEFLOW_ASSETS"
bucket_name = "estateflow-assets"

[[env.production.r2_buckets]]
binding = "PROFILE_PHOTOS"
bucket_name = "profile-photos"

[[env.production.r2_buckets]]
binding = "PROPERTY_IMAGES"
bucket_name = "property-images"

[[env.production.r2_buckets]]
binding = "DOCUMENTS"
bucket_name = "documents"

[[env.production.r2_buckets]]
binding = "QR_CODES"
bucket_name = "qr-codes"

# Preview Environment
# ========================================
# Preview deployments for PR testing
[env.preview]
ENVIRONMENT = "preview"
PLATFORM_URL = "https://estateflow-preview.pages.dev"
REGION = "US"
DEFAULT_LOCALE = "en"
SESSION_SECRET = "preview-session-secret"
POSTHOG_HOST = "https://app.posthog.com"
PR_DOMAIN = "pinexacto-preview.pages.dev"
US_DOMAIN = "truepoint-preview.pages.dev"
MAIN_DOMAIN = "estateflow-preview.pages.dev"

# Preview KV Namespaces
[[env.preview.kv_namespaces]]
binding = "LINKS"
id = "ec019d5680f947a3a0168d9ae49538a0"

[[env.preview.kv_namespaces]]
binding = "PINS"
id = "32fa94570ef447adab5164ad83f1472b"

[[env.preview.kv_namespaces]]
binding = "CACHE"
id = "3b7a129d1c834cad988a406cff5d9e45"

[[env.preview.kv_namespaces]]
binding = "ANALYTICS_BUFFER"
id = "f3019821e7b64f1aa9650c1edacb6f1f"

# Preview R2 Buckets
[[env.preview.r2_buckets]]
binding = "ESTATEFLOW_ASSETS"
bucket_name = "estateflow-assets-preview"

[[env.preview.r2_buckets]]
binding = "PROFILE_PHOTOS"
bucket_name = "profile-photos-preview"

[[env.preview.r2_buckets]]
binding = "PROPERTY_IMAGES"
bucket_name = "property-images-preview"

[[env.preview.r2_buckets]]
binding = "DOCUMENTS"
bucket_name = "documents-preview"

[[env.preview.r2_buckets]]
binding = "QR_CODES"
bucket_name = "qr-codes-preview"

# Development server settings
[dev]
port = 8788
local_protocol = "http"
ip = "127.0.0.1"